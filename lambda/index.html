<!DOCTYPE html>
<body>
<div>Login With Amazon</div>
<div id="amazon-root"> Amazon Root</div>
<a href id="LoginWithAmazon">
    <img border="0" alt="Login with Amazon"
        src="https://images-na.ssl-images-amazon.com/images/G/01/lwa/btnLWA_gold_156x32.png"
        width="156" height="32" />
 </a>

 <script type="text/javascript">

    window.onAmazonLoginReady = function() {
      amazon.Login.
      setClientId
      //('amzn1.application-oa2-client.45e216f2fc214eec95a17fd39a95146c')
      ('amzn1.application-oa2-client.8e364cf34cb649508a1746e26a4429d4');
      // amazon.Login.setSiteDomain(window.location.hostname);
    };
    const getProfileInfoFunc = () => {
    var access_token = 'Atza|IwEBIPOX9q1GH0g4QTkSASnVkMsapmz26_KbsQXjCY75NuN1AL-V-j0zlEbqm9ReaMP4AtZ3yVhaRaAI6Rwb2QxY5HNuiJuxIc4F3Trrcrf5Cn6cjRHC_L1cB_JH8BcvokTAg3Bw9eWpjPfGmYthkj-SF95IxFVhWNEjR2RAxfIIL9rOChKMVx51PyTZsysXZULKhAwGhsKe5QcMlTraTQxZebKlIbfXaLe2scSltDDfmsT8YB5kSBjKyf7_rssmrESmuzZmojg5lI9ghz7pY29fI2QCSxmmQMl7-Z0_vT_kwKzMnz41FzhBn5jnZgO5pDw_L23T0eO6NYczMEXpDRp0z7m4NV9XMTH6Zk4WHYNt7Uu7ICKho2ZIVy9mZr4Fs1QeKFs';

    amazon.Login.retrieveProfile(access_token, function(response) {
   
    if ( response.success ) {
        alert('Hello, ' + JSON.stringify(response.profile));
    }
    else {
        alert('Oh no! An error happened: ' + response.error);
    }
    });
   }
   const createCallBack = (callback) => callback('called');
    
   const callThis = (a)  => alert(a );
    
   const createATag = () =>{
        
      let getRoot = document.getElementById('amazon-root')
      let a = document.createElement('script'); 
      a.type = 'text/javascript';
      a.async = true;
      a.id = 'amazon-login-sdk';
      a.src = 'https://assets.loginwithamazon.com/sdk/na/login1.js';
      getRoot.appendChild(a);
      
      let thisObject = document.getElementById('LoginWithAmazon')
        thisObject.addEventListener("click", () => {  
        let access_token = 'Atza|IwEBIPOX9q1GH0g4QTkSASnVkMsapmz26_KbsQXjCY75NuN1AL-V-j0zlEbqm9ReaMP4AtZ3yVhaRaAI6Rwb2QxY5HNuiJuxIc4F3Trrcrf5Cn6cjRHC_L1cB_JH8BcvokTAg3Bw9eWpjPfGmYthkj-SF95IxFVhWNEjR2RAxfIIL9rOChKMVx51PyTZsysXZULKhAwGhsKe5QcMlTraTQxZebKlIbfXaLe2scSltDDfmsT8YB5kSBjKyf7_rssmrESmuzZmojg5lI9ghz7pY29fI2QCSxmmQMl7-Z0_vT_kwKzMnz41FzhBn5jnZgO5pDw_L23T0eO6NYczMEXpDRp0z7m4NV9XMTH6Zk4WHYNt7Uu7ICKho2ZIVy9mZr4Fs1QeKFs';

       try {

        options = {}
        let urlCode = false;
        options.scope = 'profile:user_id';
        options.popup = false
        options.response_type = 'code';
        next = 'http://127.0.0.1:5500/lambda/index.html'
        //'https://skills-store.amazon.com/api/skill/link/M2FC9FL6SREJQF'
       //createCallBack(callThis)
        let getResult = amazon.Login.authorize(options, next)
        alert(JSON.stringify(getResult)) 
        } catch (error) {
            alert(error)
        }
      })
    }
   const getUrlCode = () => {
            let findCode = new URLSearchParams(window.location.search).get('code')
            alert(findCode)
            if(findCode !== null){
                localStorage.setItem('appcode',findCode)
            }
        }
   const useCodeUrl = () => {
    let thisCode = localStorage.getItem('appcode')
    if(thisCode !== null){
        alert(`thisCode ${thisCode}`)
        generateAccessToken(thisCode)
    }
   }
   const generateAccessToken = (thisCode) => {
        amazon.Login.retrieveToken(thisCode, function(response) {
            if ( response.success ) {
                alert(`Response, ${response.success}` );
                localStorage.removeItem('appcode')
                localStorage.setItem('appaccesstoken',response.access_token)
            }
            else alert("error");
        }) 
   }
        getUrlCode()  
        useCodeUrl()      
        createATag() 

</script>
</body>
</html>
 